## 권한

### 파일 정보 보기  
리눅스에 접속하여 <code>ls -al {파일명 혹은 디렉토리 경로}</code>를 입력하면 해당 파일 혹은 디렉토리 내의 파일들의 권한을 보여준다.
![image](https://github.com/jisoo449/TIL/assets/48276691/22a0aba5-cbf4-4fc9-a586-d28cfc3799ae)  
위 사진을 살펴보자. 맨 앞에 적힌 -, r, w, x 등과 같은 글자로 이루어진 문자열은 파일의 접근 권한을 나타낸다.  
<br/><br/>

### 파일 접근 권한의 종류  
위 사진에 적힌 문자열은 세 문자씩 사용자 계층이 나뉜다. 이러한 사용자 계층은 파일에 접근할 수 있는 사용자의 정보로 나뉜다. 
파일의 권한을 가질 수 있는 그룹은 크게 세 계열로 나뉜다.
- 파일의 소유자(User) : 첫번째 세 글자
- 그룹(Group) : 두 번째 세 글자
- 그 외(Other) : 세 번째 세 글자
<br/>
위와 같은 사용자들은 읽기(r), 쓰기(w), 만들기(x) 의 권한을 가질 수 있다. 즉, 세 글자 안에는 차례대로 <code>rwx</code>가 들어갈 수 있는 것이다.  
이 9자리의 문자열은 세 자리 숫자로 쓸 수 있다. 문자열 세 개는 각각 2의 2승, 2의 1승, 2의 0승으로 나뉘며, 문자가 적혀 있다면 1, 그렇지 않다면 0으로 친다. 이 세 개의 문자열 세트를 숫자로 변환하는 것이다. 
예시를 보며 더 자세히 파악 해 보자.  <br/>
<code>-rw-r--r--</code>: 644. 파일의 소유자는 해당 파일을 읽고 쓸 수 있고, 같은 그룹에 속하는 사용자나 그 외 사용자는 해당 파일을 읽는 것만 가능하다.<br/>
<code>-rwxr-xr-x</code>: 755. 파일의 소유자는 읽고, 쓰고, 생성이 가능하며, 같은 그룹에 속하는 사용자나 그 외는 읽고 생성하는 것만 가능하다.  
<br/><br/>

### chmod - 파일 접근 권한 수정
<code>chmod {숫자} {파일명}</code>를 입력하여 특정 파일이나 폴더의 소유권을 바꿀 수 있다. 이는 접근 권한을 숫자로 표현해야 한다. 
이게 어려운 사람은 <code>chmod {g/o}{+/-}{r/w/x} {파일명}</code>을 사용해 접근권한을 변경할 수 있다.
<br/><br/>

### chown - 파일 소유자 변경
파일 소유자를 변경하고 싶다면 다음과 같은 코드를 사용해 변경할 수 있다.  
<code>chown {타겟사용자} {파일명}</code>
<br/><br/>

### /etc/passwd (사용자 정보)
<code>vi /etc/passwd</code>를 통해 해당 디렉토리 파일 안을 살펴보면 시스템에 등록된 사용자들의 정보를 확인할 수 있다. 해당 파일을 사용하여 사용자의 계정과 인증을 관리하게 된다. 
![image](https://github.com/jisoo449/TIL/assets/48276691/4a25a5c1-6909-4414-bd8c-e6365a8d88e1)
각 필드는 콜론으로 구분되며, 다음과 같은 의미를 가진다.  

|필드|설명|
|-------|-------------------|
|사용자 계정명|root나 등록한 사용자 계정명을 나타낸다|
|패스워드|비밀번호를 의미하며, x는 사용자의 패스워드가 /etc/shadow에 암호화되어 저장되어 있다는 뜻이다.|
|UID|사용자의 user id를 나타낸다. 관리자(root)의 UID는 0이다.|
|GID|사용자의 group id를 나타낸다. 관리자 그룹(Root)의 GID는 0이다.|
|comment|사용자와 관련된 기타 정보로, 일반적으로는 사용자의 이름을 저장한다.|
|홈 디렉토리|사용자의 홈 디토리를 의미한다. 해당 계정으로 처음 컴퓨터에 접속 시 해당 위치로 들어가게 된다.|
|로그인 쉘| 사용자가 로그인 할 때(프로그램에 접속 할 때 마다) 필요한 쉘이다. |

<br/><br/>

### /etc/shadow
/etc/shadow 의 권한을 살펴보자
![image](https://github.com/jisoo449/TIL/assets/48276691/16168aaa-0871-42b4-8f0a-0ea6a2e0296d)
/etc/shadow 는 root만이 해당 파일에 대한 접근 권한을 가진다는 것을 알 수 있다.  
일반 사용자 모드에서 해당 파일을 조회하면 permission denieed가 뜬다. 이 파일에 접근하려면 sudo 명령어를 사용해야 한다.  
![image](https://github.com/jisoo449/TIL/assets/48276691/5bc82479-fb90-471a-ab87-07266d5dd665)  
<br/>
각 필드는 컬럼으로 구분되며, 다음과 같은 의미를 가진다. 

|필드|설명|
|-------|-------------------|
|사용자 계정명|root나 등록한 사용자 계정명을 나타낸다|
|암호화된 패스워드|암호화된 패스워드 의미하며, 각 필드는 다시 $ 로 구분된다.<br/> <code>$algorithm_id$salt$encrypted_password</code> <br/> algorithm_id : 암호학적 해시의 id를 의미(ex.MD5, SHA-512) <br/> salt : 각 해쉬에 첨가할 랜덤값으로, 이 랜덤값에 따라서 해시의 값이 바뀐다. <br/> encrypted_password : 마지막은 알고리즘과 salt로 패스워드를 암호화한 값<br/> 이 외에도 *(패스워드 잠김. 별도 인증방식으로만 로그인 가능), !(패스워드 잠김. 로그인 불가), empty(패스워드 설정 안됨. 로그인 가능) 또는 빈 값이 설정될 수 있다. |
|마지막 변경|마지막으로 패스워드를 변경한 날을 1970년 1월 1일 기준으로 일수도 표시|
|패스워드 최소 사용기간|패스워드를 변경한 이후 최소 이 정도의 기간은 써야한다는 것을 의미. 해당 기간 전에는 암호 변경 불가.|
|패스워드 최대 사용기간|마지막 패스워드 변경 이후 만료일수. 90일 권|
|경고|패스워드 만료 이전에 경고할 경고 일수|
|비활성화|패스워드 만료 후 계정이 잠기기 전까지 비활성 일수. 이 기간 내에 암호를 변경해야 계정이 잠기지 않는다.|
|만료일|계정 만료일으 1970년 1월 1일 기준으로 일수로 표시|

<br/><br/>

### 사용자 추가 및 삭제
- <code>adduser {사용자이름}</code>  
  일반 유저 상태에서는 해당 명령어 사용이 불가하므로 앞에 sudo를 붙여 관리자 모드로 실행한다. 
  ![image](https://github.com/jisoo449/TIL/assets/48276691/3612377c-19a9-4424-8d78-68e344a3b812)
  이후 <code>sudo cat /etc/shadow/</code>를 입력해 추가한 사용자를 확인한다.  <br/>
- <code>passwd {사용자이름}</code>  
  사용자의 비밀번호를 변경한다.  <br/>
- <code>usermod --groups ubuntu newuser1</code>  
  사용자의 속성을 변경한다. 이 방법 외에도 passwd 파일을 관리자 권한으로 열어서 groupId의 번호를 바꿔주는 방식으로도 속성 변경이 가능하다.  <br/>
- <code>userdel {사용자이름}</code>  
  사용자를 삭제하는 명령어이다. 하지만 해당 명령어를 수행하고도 home 디렉토리 밑에는 여전히 해당 사용자의 디렉토리가 남아있다.
  <code>ls -al</code>을 통해 디렉토리 정보를 확인하면 1001번 권한만 있고 사용자 이름은 없는 것을 확인할 수 있다.  <br/>
- <code>change -{옵션} {숫자} {사용자이름}</code>  
  사용자 암호를 주기적으로 변경하도록 설정 
